                                .ORIG   x3000

LD R1, EXE1
LD R2, EYE2

JSR ENEMY_UNRENDER
JSR ENEMY_MOVEMENT
JSR ENEMY_RENDER
JSR SAVE_FOR

MAINE_LOOP

LD R0, ESAVE_R0
LD R1, ESAVE_R1
LD R2, ESAVE_R2
LD R3, ESAVE_R3
LD R4, ESAVE_R4
LD R5, ESAVE_R5
LD R6, ESAVE_R6
LD R7, ESAVE_R7

JSR ENEMY_UNRENDER
JSR ENEMY_MOVEMENT
JSR ENEMY_RENDER
JSR SAVE_FOR

BRnzp MAINE_LOOP

EXE1            .FILL #100
EYE2		.FILL #1
NEGATIVE_FLAG   .FILL x8000
SAVE_R0         .BLKW  1
SAVE_R1         .BLKW  1
SAVE_R2         .BLKW  1
SAVE_R3         .BLKW  1
SAVE_R4         .BLKW  1
SAVE_R5         .BLKW  1
SAVE_R6         .BLKW  1
SAVE_R7         .BLKW  1
SAVE_R7_PLUS    .BLKW  1
ENEMY_X_POS     .BLKW  1
ENEMY_Y_POS     .BLKW  1
SLEEP_COUNTER	.FILL #0

ESAVE_R0         .BLKW  1
ESAVE_R1         .BLKW  1
ESAVE_R2         .BLKW  1
ESAVE_R3         .BLKW  1
ESAVE_R4         .BLKW  1
ESAVE_R5         .BLKW  1
ESAVE_R6         .BLKW  1
ESAVE_R7         .BLKW  1

SAVE_FOR
ST R0, ESAVE_R0
ST R1, ESAVE_R1
ST R2, ESAVE_R2
ST R3, ESAVE_R3
ST R4, ESAVE_R4
ST R5, ESAVE_R5
ST R6, ESAVE_R6
ST R7, ESAVE_R7
ret

;---------------------------------------------------------U
ENEMY_UNRENDER
ST R1, SAVE_R1
ST R2, SAVE_R2
ST R7, SAVE_R7

JSR FIRST_PIXEL
LEA R0, ENEMY
LDR R1,R0, #0
LDR R2,R0, #1
JSR UNRENDER

LD R1, SAVE_R1
LD R2, SAVE_R2
LD R7, SAVE_R7
ret
;-----------------------------------------------------------U
;------------------------------------------------------M
ENEMY_MOVEMENT
ST R1, SAVE_R1
ST R2, SAVE_R2

LD R5, SLEEP_COUNTER
ADD R5, R5, #1
ST R5, SLEEP_COUNTER
ADD R5, R5, #-16
BRzp RESET_CON
BRnzp END_MOVE

RESET_CON
AND R5, R5, #0
ST R5, SLEEP_COUNTER


SE_MOVE
LD R5, Y_MAX
ADD R5, R5, R2
BRz BACK_UP
ADD R2, R2, #1
BRnzp END_MOVE

BACK_UP
LD R2, EYE2

END_MOVE
ret
;-------------------------------------------------------------M
;-------------------------------------------------------------R
ENEMY_RENDER
ST R1, SAVE_R1
ST R2, SAVE_R2
ST R7, SAVE_R7

JSR FIRST_PIXEL
LEA R0, ENEMY
LDR R1,R0, #0
LDR R2,R0, #1
LEA R4, ENEMY_PIXELS
ADD R4, R4, #-1
JSR RENDER

LD R1, SAVE_R1
LD R2, SAVE_R2
LD R7, SAVE_R7
ret
;---------------------------------------------------------R


DETECTOR_INPUT      .FILL   xFE00
KEYBOARD_INPUT      .FILL   xFE02
ASCII_A             .FILL #-97
ASCII_W             .FILL #-119 
ASCII_D             .FILL #-100
ASCII_S             .FILL #-115
MASK                .FILL x00FF
X_MAX               .FILL #-117
Y_MAX               .FILL #-116


RENDER
LD R6, ROW
ADD R4,R4, #1
LDR R5,R4, #0
BRn CHECK_INVIS
STR R5,R3, #0
CHECK_INVIS
ADD R3,R3, #1
ADD R1,R1, #-1
BRp RENDER
ADD R3, R3, R6
LDR R1, R0, #0
NOT R6, R1
ADD R6, R6, #1
ADD R3, R3, R6
ADD R2,R2, #-1 
BRp RENDER
ret

UNRENDER
LD R6, ROW
LD R5, BLACK
STR R5,R3, #0
ADD R3, R3, #1
ADD R1, R1, #-1
BRp UNRENDER
ADD R3, R3, R6
LDR R1, R0, #0
NOT R6, R1
ADD R6, R6, #1
ADD R3, R3, R6
ADD R2,R2, #-1 
BRp UNRENDER
ret

PANTALLA      .FILL xC000
ROW           .FILL x0080
BLACK         .FILL x0000


FIRST_PIXEL
LD R3, PANTALLA
LD R6, ROW
ADD R3, R3, R1
ADD R2, R2, #0
BRz END_FSTPXL
SUM_ALTO
ADD R3, R3, R6
ADD R2, R2, #-1
BRp SUM_ALTO
END_FSTPXL
ret



ENEMY	.FILL 7
	.FILL 8
	
ENEMY_PIXELS
	.FILL xF000
	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL xF000
	.FILL xF000
	.FILL xF000

	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL xF000
	.FILL xF000

	.FILL xF000
	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL xF000
	.FILL xF000
	.FILL xF000

	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL xF000
	.FILL xF000

	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL x533D
	.FILL x01C0
	.FILL xF000
	.FILL xF000

	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL x533D
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0

	.FILL xF000
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL x01C0
	.FILL xF000

	.FILL xF000
	.FILL xF000
	.FILL xF000
	.FILL x01C0
	.FILL xF000
	.FILL xF000
	.FILL xF000
